[toc]

# 一、Qt 基础

## 1.1 简介

Qt 常用于开发图形界面应用程序，但它除了绘制优秀的界面外还内置了很多其他的功能，多线程、访问数据库、图库处理、音频视频处理、网络通信、文件操作等。其主要用于桌面级和嵌入式的开发。

## 1.2 优点

Qt 相对于其他 GUI 库的优点：

* 简单易学：封装的很好，不需要了解windows API
* 资料丰富：其用户数量庞大，无论是官方还是非官方的资料都很齐全
* 界面优秀：可以较为容易的做出漂亮的界面和炫酷的动画
* 独立安装：全部编译为本地代码，不需要其他库的支撑
* 跨平台：跨平台支持很好，成本很低

## 1.3 Qt 开发工具列表

| 工具          | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| **qmake**     | 核心的项目构建工具，可以生成跨平台的 **.pro 项目文件**，并能依据不同操作系统和编译工具生成相应的 Makefile，用于构建可执行程序或链接库。 |
| **uic**       | User Interface Compiler，用户界面编译器，Qt 使用 XML 语法格式的 `.ui` 文件定义用户界面，uic 根据 `.ui` 文件生成用于创建用户界面的 cpp 代码头文件，比如 `ui_xxxx.h` 。 |
| moc           | Meta-Object Compiler，元对象编译器，moc 处理 C++ 头文件的类定义里面的 Q_OBJECT 宏，它会生成源代码文件，比如 `moc_xxx.cpp` ，其中包含相应类的元对象代码，元对象代码主要用于实现 Qt 信号/槽机制、运行时类型定义、动态属性系统。 |
| `rcc`         | Resource Compiler，资源文件编译器，负责在项目构建过程中编译 `.qrc` 资源文件，将资源嵌入到最终的 Qt 程序里。 |
| **qtcreator** | 集成开发环境，包含项目生成管理、代码编辑、图形界面可视化编辑、 编译生成、程序调试、上下文帮助、版本控制系统集成等众多功能， 还支持手机和嵌入式设备的程序生成部署。 |
| assistant     | Qt 助手，帮助文档浏览查询工具，Qt 库所有模块和开发工具的帮助文档、示例代码等都可以检索到，是 Qt 开发必备神器，也可用于自学 Qt。 |
| **designer**  | Qt 设计师，专门用于可视化编辑图形用户界面（所见即所得），生成 `.ui` 文件用于 Qt 项目，或者用于设计 `QML` 界面。 |
| **linguist**  | Qt 语言家，代码里用 tr() 宏包裹的就是可翻译的字符串，开发人员可用 `lupdate` 命令生成项目的待翻译字符串文件 `.ts`，用 linguist 翻译多国语言 `.ts` ，翻译完成后用 `lrelease` 命令生成 `.qm` 文件，然后就可用于多国语言界面显示。 |
| `qmlscene`    | 在 `Qt 4.x` 里是用 `qmlviewer` 进行 `QML` 程序的原型设计和测试，Qt 5 用 `qmlscene` 取代了旧的 `qmlviewer`。新的 `qmlscene` 另外还支持 Qt 5 中的新特性 `scenegraph` 。 |

## 1.4 项目组成和管理

在 Qt Creator 左侧工具栏中单击 “编辑” 按钮，即可进入项目管理窗口，Qt Creator 可以打开多个项目，但只有一个活动项目，活动项目名称加粗显示。

在项目名称节点下，分组管理着各种源文件，文件和分组如下：

* `xxx.pro` 文件是项目管理文件，包括一些对项目的设置项。
*  Headers 分组，该节点下是项目内的所有 cpp 头文件（`.h`） 
*  Sources 分组：该节点下是项目内的所有 cpp 源文件（`.cpp`） 
* Resources 分组：该节点下是项目内的各种资源文件，如 `QML` 文件，图标（图片）文件，翻译文件等
  * 使用 `qrc` 文件加载资源
*  Forms 分组：该节点下是项目内的所有界面文件（`.ui`） 用 `QML` 编写界面则没有（`.ui`）文件

## 1.5 `.pro` 文件详解

在此文件中 # 为注释

```bash
TEMPLATE = app                  #表示项目使用的模板是app，是一般的应用程序
QT += qml quick gui widgets     #表示项目中加入qml quick gui widgets模块
TARGET = MYPlayer               #表示生成的目标可执行文件的名称
RESOURCES += resource/MYPlayer.qrc   #资源项目文件
TRANSLATIONS += ./resource/ui/translation/MYPlayer_zh_CN.ts  #翻译文件
SOURCES += \            
        main.cpp \
        MainApp.cpp
HEADERS += MainApp.h
```

## 1.6 Qt 元对象系统

Qt 的元对象系统（Meta-Object System）提供了对象之间通信的信号与槽机制、运行时类型信息和动态属性系统。 

> 元对象系统由以下三个基础组成：
>
> - `QObject` 类是所有使用元对象系统的类的基类。
>
> - 在一个类的 `private` 部分声明 Q_OBJECT 宏，使得类可以使用元对象的特性，如动态属性、信号与槽。
>
> - `MOC`（元对象编译器）为每个 `QObject` 的子类提供必要的代码来实现元对象系统的特性。

构建项目时，`MOC` 工具读取 C++ 源文件，当它发现类的定义里有 Q_OBJECT 宏时，它就会为这个类生成另外一个包含有元对象支持代码的 cpp 源文件，这个生成的源文件连同类的实现文件一起被编译和连接。 

## 1.7 Qt基本模块

| 模块                  | 描述                                                         |
| --------------------- | ------------------------------------------------------------ |
| Qt Core               | 其他模块都用到的核心非图形类                                 |
| **Qt GUI**            | 设计 GUI 界面的基础类，包括 `OpenGL`                         |
| **Qt Multimedia**     | 音频、视频、摄像头和广播功能的类                             |
| Qt Multimedia Widgets | 实现多媒体功能的界面组件类                                   |
| Qt Network            | 使网络编程更简单和轻便的类                                   |
| `Qt QML`              | 用于 `QML` 和 [JavaScript](http://c.biancheng.net/js/) 语言的类 |
| **Qt Quick**          | 用于构建具有定制用户界面的动态应用程序的声明框架             |
| **Qt Quick Controls** | 创建桌面样式用户界面，基于 Qt Quick 的用户界面控件           |
| **Qt Quick Dialogs**  | 用于 Qt Quick 的系统对话框类型                               |
| Qt Quick Layouts      | 用于 Qt Quick 界面元素的布局项                               |
| Qt SQL                | 使用 SQL 用于数据库操作的类                                  |
| Qt Test               | 用于应用程序和库进行单元测试的类                             |
| Qt Widgets            | 用于构建 GUI 界面的 [C++](http://c.biancheng.net/cplus/) 图形组件类 |

## 1.8 Qt 定时器

`QTimer` 类： 如果 Qt 无法交付所请求的计时器事件数量，它将静默地丢弃一些计时器事件。所以有时候用 `QTimer` 可能不能正常刷新，此时可以使用 `startTimer`。

> - 用 `startTimer` 启动一个定时器，并返回定时器 id。如果启动失败，返回0
>
> - 定时器每隔 interval 毫秒就会启动一次，直到调用 `killTimer()`， 如果 `interval = 0`，当没有其他系统时间发生时，会调用一次
>
> - 当定时器发生时，会调用 `timerEvent(QTimerEvent *event)`，如果多个定时器在运行，可用通过 `timeId()` 来区分。
>
> ```c++
> startTimer(40);   // 表示一秒25帧
> ```

## 1.9 Qt 中的线程类 `QThread`

```c++
// 线程等待，强制当前线程睡眠 msecs 毫秒
void msleep(unsigned long msecs);
```

## 1.10 `QAudioFormat` 和 `QAudioOutput`

需要在 `.pro` 文件中添加：`QT += multimedia` 

> `QAudioFormat` 类
>
> | 参数               | 描述                                                   |
> | ------------------ | ------------------------------------------------------ |
> | Sample Rate        | 每秒音频数据采样数（以赫兹为单位）                     |
> | Number of channels | 音频通道数（通常为单声道一个，为立体声两个）           |
> | Sample size        | 每个样本中存储了多少数据（通常为8或16位）              |
> | Sample type        | 样本的数值表示（通常为有符号整数，无符号整数或浮点数） |
> | Byte order         | 样本的字节顺序（通常为小端，大端）                     |
>
> `QAudioOutput` 类
>
> | 函数          | 作用                                                         |
> | ------------- | ------------------------------------------------------------ |
> | `start()`     | 返回一个指向内部 `QIODevice` 的指针，该指针用于将数据传输到系统的音频输出，`write()` 可以直接向其中写入数据 |
> | `stop()`      | 停止音频输出，与系统资源分离                                 |
> | `suspend()`   | 停止处理音频数据，保留缓冲的音频数据                         |
> | `resume()`    | 在 `suspend()` 后恢复处理音频数据                            |
> | `bytesFree()` | 返回音频缓冲区中可用的字节数                                 |
> | ...           | ...                                                          |
>

# 二、`QML`基础

`QML` 是一种标记语言，类似于网页设计的 HTML，主要用于描述程序界面，用于定义用户界面元素的外观和行为，可以借助 `CSS` 对它进行美化，也可以借助`JavaScript` 进行交互，注释方式与 `C++` 相同。

> 使用 `QML` 开发界面优点如下：
> * `QML` 很灵活，可以做出炫酷的效果
> * `QML` 是标记语言，容易编写和理解，也易于学习
> * `QML` 界面简洁且美观，自带很多动画
> * 不同平台的 `QML` 使用相同的渲染机制，界面效果一致，不会随操作系统的同而变化

## 2.1 `QML`基础语法

一个`QML`文档分为 import 和对象生命两个部分。

> * import：用于指定该文档所需要引入的模块。通常这是一个模块名和版本号，比如 `QtQuick 2.0`，也可以引入自己的模块或者其他文件
> * `QML` 元素：一个 `QML` 文档有且只有一个根元素，类似 XML 
> * `QML` 文档中的元素类似 XML 文档
>

## 2.2 `QML`元素关系

层次关系：子元素处于相对于父元素的坐标系统中，即子元素 x 和 y 的坐标值始终相对于父元素。
## 2.3 `QML`基础属性

`QML` 属性的值由其类型决定，如果一个属性没有给值，则会使用属性的默认值，自定义属性会给定系统类型的默认值。

`QML` 属性可以依赖于其他属性，这种行为被称为绑定，类似于信号槽机制，所依赖属性发生变化，该属性会得到通知，自动更新自己的值。

`QML` 所有属性都有对应数值改变的槽函数，格式为 `on + 属性名 + Changed`，属性名首字母大写，属性改变会发出相应的信号比如 `height` 属性改变，发出 `heightChanged` 信号。

# 三、Visual Studio 开发 Qt 项目

使用 Visual Studio开发 Qt 项目，得益于 Visual Studio 的强大功能，可以极大的提高项目的开发效率。

> ###### 配置所需要的相关环境
>
> - 下载 QT Creator 并且搭建 Qt 开发环境
>
> - 下载 Visual Studio 相关的 Qt 插件
>
> - 下载 `windows SDK`
>
> ###### 基本步骤
>
> - 使用 QT Creator 创建一个 QT 项目
> - 在 QT 项目文件夹下，使用命令 `qmake -tp vc` 构建 VS 项目，使用 VS 打开生成的 `.vcxpro` 项目文件